<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Classical Dance Learning - MediaPipe</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#FF9933",
                        "accent": "#D4AF37",
                        "background-light": "#f8f6f8",
                        "background-dark": "#1a0f1a",
                        "saffron": "#FF9933",
                        "gold": "#D4AF37",
                        "charcoal": "#121212"
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px"},
                },
            },
        }
    </script>
    <style>
        body { font-family: 'Lexend', sans-serif; }
        .skeleton-line { stroke: rgba(255, 153, 51, 0.6); stroke-width: 2; }
        .guru-skeleton { stroke: rgba(212, 175, 55, 0.4); stroke-width: 1.5; }
        .glass-panel { background: rgba(26, 15, 26, 0.8); backdrop-filter: blur(12px); }
        body { min-height: max(884px, 100dvh); }
    </style>
    <link rel="stylesheet" href="src/styles/style.css">
</head>
<body class="bg-background-dark text-white overflow-hidden h-screen w-screen">

<!-- Top Navigation Bar -->
<div class="fixed top-0 left-0 right-0 z-50 flex items-center bg-background-dark/80 backdrop-blur-md p-4 justify-between border-b border-white/10">
    <div class="flex items-center gap-3">
        <div class="material-symbols-outlined text-white cursor-pointer hover:text-saffron transition">arrow_back</div>
        <div>
            <h2 class="text-white text-base font-bold leading-tight" id="navTitle">Indian Classical Dance</h2>
            <p class="text-xs text-saffron/80 font-medium" id="navSubtitle">Select a Dance Form</p>
        </div>
    </div>
    <div class="flex gap-2">
        <button id="settingsBtn" class="bg-white/10 p-2 rounded-full flex items-center justify-center hover:bg-white/20 transition">
            <span class="material-symbols-outlined text-gold">settings</span>
        </button>
        <button class="bg-primary p-2 rounded-full flex items-center justify-center hover:bg-primary/80 transition">
            <span class="material-symbols-outlined text-white">share</span>
        </button>
    </div>
</div>

<!-- Main Viewport -->
<div class="relative w-full h-full pt-16 pb-32 overflow-hidden bg-charcoal flex flex-col items-center justify-center">
    
    <!-- Dance Form Selection (Initial View) -->
    <div id="danceSelection" class="absolute inset-0 pt-16 pb-32 flex flex-col items-center justify-center gap-8 z-10">
        <div class="text-center mb-4">
            <h1 class="text-4xl font-bold text-white mb-2">ðŸŽ­ Select a Dance Form</h1>
            <p class="text-saffron/80 text-sm">Learn authentic Indian classical dance with AI pose detection</p>
        </div>
        
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 px-4 max-w-4xl">
            <button class="dance-btn-new p-6 rounded-xl bg-gradient-to-br from-primary/20 to-accent/20 border border-primary/40 hover:border-primary hover:from-primary/30 hover:to-accent/30 transition-all group" data-dance="bharatanatyam">
                <div class="text-4xl mb-3">ðŸ•º</div>
                <h3 class="text-white font-bold text-sm group-hover:text-saffron transition">Bharatanatyam</h3>
                <p class="text-xs text-white/60 mt-1">South India</p>
            </button>
            <button class="dance-btn-new p-6 rounded-xl bg-gradient-to-br from-primary/20 to-accent/20 border border-primary/40 hover:border-primary hover:from-primary/30 hover:to-accent/30 transition-all group" data-dance="kathak">
                <div class="text-4xl mb-3">ðŸ’ƒ</div>
                <h3 class="text-white font-bold text-sm group-hover:text-saffron transition">Kathak</h3>
                <p class="text-xs text-white/60 mt-1">North India</p>
            </button>
            <button class="dance-btn-new p-6 rounded-xl bg-gradient-to-br from-primary/20 to-accent/20 border border-primary/40 hover:border-primary hover:from-primary/30 hover:to-accent/30 transition-all group" data-dance="kathakali">
                <div class="text-4xl mb-3">ðŸŽ­</div>
                <h3 class="text-white font-bold text-sm group-hover:text-saffron transition">Kathakali</h3>
                <p class="text-xs text-white/60 mt-1">Kerala</p>
            </button>
            <button class="dance-btn-new p-6 rounded-xl bg-gradient-to-br from-primary/20 to-accent/20 border border-primary/40 hover:border-primary hover:from-primary/30 hover:to-accent/30 transition-all group" data-dance="odissi">
                <div class="text-4xl mb-3">ðŸŒ¸</div>
                <h3 class="text-white font-bold text-sm group-hover:text-saffron transition">Odissi</h3>
                <p class="text-xs text-white/60 mt-1">Odisha</p>
            </button>
        </div>
    </div>

    <!-- Practice View (Hidden Initially) -->
    <div id="practiceView" class="hidden absolute inset-0 pt-16 pb-32 w-full h-full flex flex-col">
        
        <!-- Main Video Container -->
        <div class="relative flex-1 flex items-center justify-center px-4">
            <div class="relative w-full h-full max-w-3xl bg-black rounded-2xl overflow-hidden shadow-2xl border border-primary/30">
                <video id="video" class="w-full h-full object-cover"></video>
                <canvas id="canvas" class="absolute inset-0 w-full h-full"></canvas>
                
                <!-- Current Pose Info Overlay -->
                <div class="absolute top-4 left-4 right-4">
                    <div class="glass-panel rounded-lg p-3 border border-white/10 flex items-center justify-between">
                        <div>
                            <p class="text-[10px] uppercase tracking-widest text-gold font-bold">Current Pose</p>
                            <h3 class="text-white text-sm font-bold" id="currentPoseName">Select a Pose</h3>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] uppercase tracking-widest text-primary font-bold">Form</p>
                            <p class="text-white text-xs font-bold" id="currentDanceName">-</p>
                        </div>
                    </div>
                </div>
                
                <!-- Playback Overlay -->
                <div id="playPauseOverlay" class="absolute inset-0 flex items-center justify-center opacity-0 pointer-events-none transition">
                    <div class="bg-black/40 rounded-full p-6 backdrop-blur-sm border border-white/20">
                        <span class="material-symbols-outlined text-white text-4xl" style="font-variation-settings: 'FILL' 1">play_arrow</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Side HUD -->
        <div class="fixed right-4 top-24 bottom-32 w-20 flex flex-col gap-4 pointer-events-none">
            <!-- Accuracy Ring -->
            <div class="glass-panel p-3 rounded-xl border border-white/10 flex flex-col items-center pointer-events-auto shadow-xl">
                <div class="relative flex items-center justify-center size-14">
                    <svg class="size-full -rotate-90">
                        <circle class="text-white/10" cx="28" cy="28" fill="transparent" r="24" stroke="currentColor" stroke-width="4"></circle>
                        <circle id="accuracyRing" class="text-primary transition-all" cx="28" cy="28" fill="transparent" r="24" stroke="currentColor" stroke-dasharray="150" stroke-dashoffset="150" stroke-width="4"></circle>
                    </svg>
                    <span id="accuracyPercent" class="absolute text-[12px] font-bold">0%</span>
                </div>
                <p class="text-[8px] font-bold text-center mt-2 uppercase opacity-60">Accuracy</p>
            </div>
            
            <!-- Sync Meter -->
            <div class="glass-panel p-3 rounded-xl border border-white/10 flex flex-col items-center pointer-events-auto shadow-xl flex-1">
                <p class="text-[8px] font-bold text-center mb-4 uppercase opacity-60">Sync</p>
                <div class="flex-1 w-1 bg-white/10 rounded-full relative overflow-hidden">
                    <div id="syncBar" class="absolute bottom-0 w-full bg-saffron h-0 rounded-full transition-all duration-300"></div>
                    <div id="syncDot" class="absolute bottom-0 left-1/2 -translate-x-1/2 size-2 bg-white rounded-full shadow-[0_0_10px_white] opacity-0"></div>
                </div>
                <p class="text-[10px] font-bold text-saffron mt-4 uppercase" id="syncStatus">-</p>
            </div>
        </div>
    </div>

</div>

<!-- Bottom Controls Panel -->
<div class="fixed bottom-0 left-0 right-0 bg-background-dark border-t border-white/10 p-4 pb-6 flex flex-col gap-4 z-50">
    <!-- Poses Grid -->
    <div id="posesContainer" class="flex gap-2 overflow-x-auto pb-2 px-2" style="display: none;">
        <!-- Poses will be dynamically added here -->
    </div>
    
    <!-- Control Buttons -->
    <div class="flex items-center justify-between px-2">
        <button id="resetBtn" class="flex flex-col items-center gap-1 opacity-60 hover:opacity-100 transition">
            <span class="material-symbols-outlined">restart_alt</span>
            <span class="text-[10px] uppercase font-medium">Reset</span>
        </button>
        
        <div class="flex items-center gap-6">
            <button id="recordBtn" class="bg-accent/30 p-3 rounded-full hover:bg-accent/50 transition border border-accent/50">
                <span class="material-symbols-outlined text-gold">fiber_manual_record</span>
            </button>
            <button id="startBtn" class="bg-primary p-4 rounded-full shadow-lg hover:bg-primary/80 transition border border-primary/50">
                <span class="material-symbols-outlined text-white text-3xl" style="font-variation-settings: 'FILL' 1">play_arrow</span>
            </button>
            <button id="stopBtn" class="bg-red-600/30 p-3 rounded-full hover:bg-red-600/50 transition border border-red-600/50 hidden">
                <span class="material-symbols-outlined text-red-500">stop_circle</span>
            </button>
        </div>
        
        <button id="cameraToggle" class="flex flex-col items-center gap-1 opacity-60 hover:opacity-100 transition">
            <span class="material-symbols-outlined">videocam</span>
            <span class="text-[10px] uppercase font-medium">Camera</span>
        </button>
    </div>
</div>

<!-- Toast Feedback -->
<div id="feedbackToast" class="fixed top-24 left-1/2 -translate-x-1/2 pointer-events-none opacity-0 transition-opacity duration-300">
    <div class="bg-saffron/20 border border-saffron/40 backdrop-blur-md px-6 py-2 rounded-full flex items-center gap-3">
        <span class="material-symbols-outlined text-saffron text-sm">info</span>
        <span id="feedbackText" class="text-xs font-bold text-white">Loading...</span>
    </div>
</div>

<!-- Right Side Drawer Handle -->
<div class="fixed top-1/2 -right-1 -translate-y-1/2 w-1.5 h-16 bg-white/30 rounded-l-full"></div>

<!-- MediaPipe Scripts -->
<script async src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script async src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script async src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>

<!-- Application Scripts -->
<script type="module" src="src/utils/poseDetection.js"></script>
<script type="module" src="src/data/danceData.js"></script>
<script type="module" src="src/app.js"></script>

</body>
</html>
